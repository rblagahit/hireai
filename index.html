<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HireAI â€” Hire Smarter with AI</title>
  <!-- Preconnect to CDN origins for faster script fetching -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com" />
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="dns-prefetch" href="https://firestore.googleapis.com" />
  <link rel="dns-prefetch" href="https://identitytoolkit.googleapis.com" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    * { -webkit-font-smoothing: antialiased; }
    .hidden-el { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.22s ease; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spin { animation: spin 0.7s linear infinite; display: inline-block; }
    .quota-fill { transition: width 0.4s ease; }
    @keyframes ripple { 0%{transform:scale(1);opacity:0.6} 100%{transform:scale(2.2);opacity:0} }
    @keyframes stepIn { from{opacity:0;transform:translateX(-8px)} to{opacity:1;transform:translateX(0)} }
    .step-row { animation: stepIn 0.25s ease forwards; }
    .step-dot-active { position:relative; }
    .step-dot-active::after { content:''; position:absolute; inset:-4px; border-radius:50%; background:#6366f1; opacity:0.25; animation: ripple 1.2s ease-out infinite; }
    #thinking-progress-bar { transition: width 0.7s cubic-bezier(0.4,0,0.2,1); }
    @keyframes scanline { 0%{background-position:0% 0%} 100%{background-position:0% 100%} }
    input:focus, textarea:focus, select:focus { outline: 2px solid #6366f1; outline-offset: -2px; border-color: transparent !important; }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 4px; }
    #app-loader { position:fixed;inset:0;background:#fff;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
    .loader-pulse { animation: pulse 1.4s ease-in-out infinite; }
  </style>
</head>
<body class="bg-white antialiased">

<!-- â•â•â•â•â•â•â•â• LOADING SCREEN â•â•â•â•â•â•â•â• -->
<div id="app-loader">
  <div style="background:#4f46e5;padding:12px 16px;border-radius:16px;color:#fff;font-size:20px;font-weight:900;letter-spacing:-0.5px" class="loader-pulse">AI</div>
  <p style="font-size:22px;font-weight:900;color:#0f172a;letter-spacing:-0.5px">HireAI</p>
  <p style="font-size:13px;color:#94a3b8;font-weight:600">Loadingâ€¦</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTH MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="auth-modal" style="display:none" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md">
  <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl relative fade-in">
    <button onclick="closeAuth()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-700 text-xl font-bold">âœ•</button>
    <h2 id="auth-title" class="text-2xl font-black mb-1 text-center">Welcome back</h2>
    <p id="auth-sub" class="text-center text-slate-400 text-sm mb-8">Sign in to HireAI</p>
    <form onsubmit="handleAuth(event)" class="space-y-4">
      <input id="auth-name" placeholder="Company / Your name" class="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
      <input id="auth-email" type="email" required placeholder="Email *" class="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
      <input id="auth-password" type="password" required placeholder="Password *" class="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
      <p id="auth-error" style="display:none" class="text-xs text-red-500 font-bold"></p>
      <button type="submit" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-slate-800 transition-colors">Continue</button>
    </form>
    <p class="text-center text-sm text-slate-400 mt-6">
      <span id="auth-toggle-text">Don't have an account?</span>
      <button onclick="toggleAuthMode()" id="auth-toggle-btn" class="font-bold text-indigo-600 ml-1">Sign up</button>
    </p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APPLY MODAL (public-facing candidate view)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="apply-modal" style="display:none" class="fixed inset-0 z-[90] flex items-center justify-center p-4 bg-slate-900/70 backdrop-blur-md">
  <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl relative fade-in">
    <button onclick="closeApply()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-700 text-xl font-bold">âœ•</button>

    <!-- Normal apply form -->
    <div id="apply-form-wrap">
      <p id="apply-job-label" class="text-xs font-black text-indigo-600 uppercase tracking-widest mb-2"></p>
      <h2 class="text-2xl font-black mb-1">Apply for this role</h2>
      <p class="text-slate-400 text-sm mb-8">Upload your resume and we'll be in touch.</p>
      <form onsubmit="submitApplication(event)" class="space-y-4">
        <input id="apply-name" required placeholder="Full name *" class="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
        <div>
          <input id="apply-email" type="email" required placeholder="Email address *" class="w-full px-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
          <p class="text-xs text-slate-400 mt-1.5 ml-1">Used to send interview invites or status updates â€” nothing else.</p>
        </div>
        <div onclick="document.getElementById('resume-input').click()"
          class="border-2 border-dashed border-slate-200 rounded-2xl p-8 text-center cursor-pointer hover:bg-indigo-50/50 hover:border-indigo-200 transition-colors">
          <input type="file" id="resume-input" accept=".pdf,.doc,.docx" class="hidden" onchange="onResumeSelected(event)" />
          <p class="text-3xl mb-2">ğŸ“</p>
          <p class="font-bold text-slate-600 text-sm">Upload Resume</p>
          <p id="resume-label" class="text-xs text-slate-400 mt-1">PDF or DOC / DOCX Â· max 10 MB</p>
        </div>
        <div>
          <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">
            Paste CV / Resume Text <span class="text-slate-300 font-normal normal-case tracking-normal">(optional â€” improves AI match accuracy)</span>
          </label>
          <textarea id="apply-cv-text" rows="5" placeholder="Paste your resume text, key skills, or work experience here..." class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none"></textarea>
        </div>
        <p id="apply-error" style="display:none" class="text-xs text-red-500 font-bold"></p>
        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-indigo-500 transition-colors">
          Submit Application
        </button>
        <p class="text-center text-xs text-slate-400">Your email is only used to notify you of interview scheduling or application status.</p>
      </form>
    </div>

    <!-- Success state -->
    <div id="apply-success" style="display:none" class="text-center py-8 fade-in">
      <p class="text-5xl mb-4">âœ…</p>
      <h3 class="text-2xl font-black text-slate-900 mb-2">Application sent!</h3>
      <p class="text-slate-500 text-sm">We'll review your resume and reach out via email if you're shortlisted.</p>
      <button onclick="closeApply()" class="mt-8 bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold hover:bg-indigo-500 transition-colors">Done</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REJECTION LETTER MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="reject-modal" style="display:none" class="fixed inset-0 z-[90] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md">
  <div class="bg-white w-full max-w-2xl rounded-[2.5rem] p-10 shadow-2xl relative fade-in max-h-[90vh] overflow-y-auto">
    <button onclick="closeRejectModal()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-700 text-xl font-bold">âœ•</button>
    <h2 class="text-xl font-black mb-1">Rejection Letter</h2>
    <p id="reject-to-label" class="text-sm text-slate-400 mb-6">To: â€”</p>
    <div id="reject-preview" class="bg-slate-50 border border-slate-200 rounded-2xl p-6 text-sm text-slate-700 whitespace-pre-wrap leading-relaxed mb-6 font-mono"></div>
    <div class="flex flex-wrap gap-3">
      <button onclick="openMailtoReject()" class="bg-slate-900 text-white px-5 py-3 rounded-2xl font-bold text-sm flex items-center space-x-2 hover:bg-slate-800 transition-colors">
        <span>ğŸ“§</span><span>Open in Email</span>
      </button>
      <button onclick="copyRejectText()" id="copy-reject-btn" class="border border-slate-200 px-5 py-3 rounded-2xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition-colors">
        ğŸ“‹ Copy Text
      </button>
      <button onclick="confirmReject()" class="border border-red-200 text-red-600 px-5 py-3 rounded-2xl font-bold text-sm hover:bg-red-50 transition-colors ml-auto">
        âœ“ Mark as Rejected
      </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-landing">

  <nav id="landing-nav" class="fixed w-full z-50 transition-all py-6">
    <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <div class="bg-indigo-600 p-1.5 rounded-lg text-white text-xs font-black">AI</div>
        <span class="text-xl font-black tracking-tight">HireAI</span>
      </div>
      <div class="flex items-center space-x-4">
        <button onclick="openAuth('login')" class="text-sm font-bold text-slate-700">Sign In</button>
        <button onclick="openAuth('register')" class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-indigo-500 transition-colors">Get Started Free</button>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto px-6">

    <!-- â”€â”€ HERO â”€â”€ -->
    <section class="pt-44 pb-16 text-center space-y-8">
      <div class="inline-flex items-center space-x-2 bg-indigo-50 border border-indigo-100 px-4 py-2 rounded-full">
        <span class="text-indigo-600">âš¡</span>
        <span class="text-xs font-black text-indigo-600 uppercase tracking-widest">Build HireAI in 17 Days</span>
      </div>
      <h1 class="text-6xl font-black text-slate-900 leading-tight max-w-4xl mx-auto">
        Post jobs free.<br /><span class="text-indigo-600">Screen smarter</span> with AI.
      </h1>
      <p class="text-xl text-slate-500 max-w-2xl mx-auto">
        The agentic hiring platform that turns volume applications into ranked, decision-ready talent â€” in minutes.
      </p>
      <div class="flex items-center justify-center space-x-4 flex-wrap gap-y-3">
        <button onclick="openAuth('register')" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl shadow-indigo-200 hover:bg-indigo-500 transition-colors">
          Post Your First Job â†’
        </button>
        <button onclick="openAuth('login')" class="border border-slate-200 px-8 py-4 rounded-2xl font-bold text-slate-700 hover:bg-slate-50 transition-colors">Sign In</button>
      </div>
    </section>

    <!-- â”€â”€ INFOGRAPHIC 1: PIPELINE â”€â”€ -->
    <section class="pb-16">
      <div class="bg-slate-900 rounded-[2.5rem] p-10 relative overflow-hidden">
        <!-- subtle grid bg -->
        <div class="absolute inset-0 opacity-5" style="background-image: radial-gradient(circle, #fff 1px, transparent 1px); background-size: 28px 28px;"></div>
        <p class="text-xs font-black text-slate-500 uppercase tracking-widest text-center mb-10">5-Module Product Pipeline</p>
        <div class="flex items-start justify-between relative">
          <!-- connector line -->
          <div class="absolute top-7 left-0 right-0 h-px" style="background: linear-gradient(90deg, transparent, #4f46e5 20%, #7c3aed 40%, #d97706 60%, #db2777 80%, transparent); opacity: 0.4;"></div>

          <!-- Module 1 -->
          <div class="relative z-10 flex flex-col items-center text-center w-1/5 px-3">
            <div class="w-14 h-14 rounded-2xl bg-emerald-500/20 border border-emerald-500/40 flex items-center justify-center mb-4 text-2xl">ğŸ’¼</div>
            <p class="text-sm font-black text-emerald-400 mb-1">Job Posting</p>
            <p class="text-xs text-slate-500 leading-snug">âˆ free posts<br/>Public apply page<br/>Shareable URLs</p>
            <span class="mt-3 text-xs font-bold text-emerald-600 bg-emerald-500/10 border border-emerald-500/20 px-2 py-0.5 rounded-full">Free</span>
          </div>

          <!-- arrow -->
          <div class="relative z-10 self-center pb-10 text-slate-600 text-lg font-black">â†’</div>

          <!-- Module 2 -->
          <div class="relative z-10 flex flex-col items-center text-center w-1/5 px-3">
            <div class="w-14 h-14 rounded-2xl bg-violet-500/20 border border-violet-500/40 flex items-center justify-center mb-4 text-2xl">ğŸ§ </div>
            <p class="text-sm font-black text-violet-400 mb-1">AI Screening</p>
            <p class="text-xs text-slate-500 leading-snug">Claude API<br/>200 CVs / batch<br/>~$0.003 per CV</p>
            <span class="mt-3 text-xs font-bold text-violet-400 bg-violet-500/10 border border-violet-500/20 px-2 py-0.5 rounded-full">Pro</span>
          </div>

          <!-- arrow -->
          <div class="relative z-10 self-center pb-10 text-slate-600 text-lg font-black">â†’</div>

          <!-- Module 3 -->
          <div class="relative z-10 flex flex-col items-center text-center w-1/5 px-3">
            <div class="w-14 h-14 rounded-2xl bg-amber-500/20 border border-amber-500/40 flex items-center justify-center mb-4 text-2xl">ğŸ›¡ï¸</div>
            <p class="text-sm font-black text-amber-400 mb-1">Quota Guard</p>
            <p class="text-xs text-slate-500 leading-snug">IP fingerprint<br/>Soft 80% / Hard 100%<br/>No auth needed</p>
            <span class="mt-3 text-xs font-bold text-amber-400 bg-amber-500/10 border border-amber-500/20 px-2 py-0.5 rounded-full">Pro</span>
          </div>

          <!-- arrow -->
          <div class="relative z-10 self-center pb-10 text-slate-600 text-lg font-black">â†’</div>

          <!-- Module 4 -->
          <div class="relative z-10 flex flex-col items-center text-center w-1/5 px-3">
            <div class="w-14 h-14 rounded-2xl bg-pink-500/20 border border-pink-500/40 flex items-center justify-center mb-4 text-2xl">ğŸ“Š</div>
            <p class="text-sm font-black text-pink-400 mb-1">Talent Matrix</p>
            <p class="text-xs text-slate-500 leading-snug">Top 5 â†’ Calendar<br/>Rejection letters<br/>Score breakdown</p>
            <span class="mt-3 text-xs font-bold text-pink-400 bg-pink-500/10 border border-pink-500/20 px-2 py-0.5 rounded-full">Pro</span>
          </div>

          <!-- arrow -->
          <div class="relative z-10 self-center pb-10 text-slate-600 text-lg font-black">â†’</div>

          <!-- Module 5 -->
          <div class="relative z-10 flex flex-col items-center text-center w-1/5 px-3 opacity-50">
            <div class="w-14 h-14 rounded-2xl bg-sky-500/20 border border-sky-500/40 border-dashed flex items-center justify-center mb-4 text-2xl">ğŸ“ˆ</div>
            <p class="text-sm font-black text-sky-400 mb-1">Analytics</p>
            <p class="text-xs text-slate-500 leading-snug">Funnel metrics<br/>Conversion rates<br/>Pipeline health</p>
            <span class="mt-3 text-xs font-bold text-slate-500 bg-slate-700 border border-slate-600 px-2 py-0.5 rounded-full">Soon</span>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ INFOGRAPHIC 2: KPI METRICS â”€â”€ -->
    <section class="pb-16">
      <div class="grid grid-cols-4 gap-4">
        <div class="bg-indigo-600 rounded-[1.5rem] p-7 text-white relative overflow-hidden">
          <div class="absolute -top-4 -right-4 text-8xl opacity-10 font-black">%</div>
          <p class="text-5xl font-black mb-2">94.2<span class="text-2xl">%</span></p>
          <p class="text-indigo-200 text-sm font-bold">Match Accuracy</p>
          <p class="text-indigo-300 text-xs mt-1">Claude API scoring vs manual review</p>
        </div>
        <div class="bg-slate-900 rounded-[1.5rem] p-7 text-white relative overflow-hidden">
          <div class="absolute -top-4 -right-4 text-8xl opacity-10 font-black">âš¡</div>
          <p class="text-5xl font-black mb-2">&lt;2<span class="text-2xl text-slate-400">min</span></p>
          <p class="text-slate-300 text-sm font-bold">Screen 200 CVs</p>
          <p class="text-slate-500 text-xs mt-1">End-to-end ranked output</p>
        </div>
        <div class="bg-slate-900 rounded-[1.5rem] p-7 text-white relative overflow-hidden">
          <div class="absolute -top-4 -right-4 text-8xl opacity-10 font-black">ğŸ“…</div>
          <p class="text-5xl font-black mb-2">17<span class="text-2xl text-slate-400">d</span></p>
          <p class="text-slate-300 text-sm font-bold">Full MVP Build</p>
          <p class="text-slate-500 text-xs mt-1">3 phases Â· 5 modules Â· production-ready</p>
        </div>
        <div class="bg-slate-900 rounded-[1.5rem] p-7 text-white relative overflow-hidden">
          <div class="absolute -top-4 -right-4 text-8xl opacity-10 font-black">âˆ</div>
          <p class="text-5xl font-black mb-2">âˆ</p>
          <p class="text-slate-300 text-sm font-bold">Job Posts</p>
          <p class="text-slate-500 text-xs mt-1">Free forever â€” no cap, no expiry</p>
        </div>
      </div>
    </section>

    <!-- â”€â”€ INFOGRAPHIC 3: FEATURE SCOPE â”€â”€ -->
    <section class="pb-20">
      <div class="flex items-end justify-between mb-8">
        <div>
          <h2 class="text-2xl font-black text-slate-900">Feature Scope</h2>
          <p class="text-slate-500 text-sm mt-1">17-day MVP on the left Â· Month 2 deferrals faded on the right</p>
        </div>
        <div class="flex items-center space-x-4 text-xs font-bold">
          <span class="flex items-center space-x-1.5"><span class="w-3 h-3 rounded-full bg-indigo-500 inline-block"></span><span class="text-slate-500">In Scope</span></span>
          <span class="flex items-center space-x-1.5"><span class="w-3 h-3 rounded-full bg-slate-300 inline-block border border-dashed border-slate-400"></span><span class="text-slate-400">Month 2</span></span>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-6">
        <!-- MVP Column -->
        <div class="space-y-3">
          <p class="text-xs font-black text-indigo-600 uppercase tracking-widest flex items-center space-x-2 mb-4">
            <span class="w-1.5 h-4 bg-indigo-600 rounded-full inline-block"></span><span>MVP â€” 17 Days (11.5d total)</span>
          </p>

          <!-- Feature card helper: name | tier | phase | days bar -->
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ’¼</span>
                <span class="font-black text-slate-900 text-sm">Job Posting Tool</span>
                <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-lg">Free</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.1</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-emerald-400 rounded-full" style="width:30%"></div>
              </div>
              <span class="text-sm font-black text-indigo-600 w-8 text-right">3.5d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Form + DB Â· Apply Page Â· URL + Board Â· Auto-trigger</p>
          </div>

          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ§ </span>
                <span class="font-black text-slate-900 text-sm">AI Resume Screening</span>
                <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.1</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-violet-500 rounded-full" style="width:35%"></div>
              </div>
              <span class="text-sm font-black text-indigo-600 w-8 text-right">4d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Claude API Â· Google Drive Â· OneDrive Â· 200 CV batch cap</p>
          </div>

          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ“Š</span>
                <span class="font-black text-slate-900 text-sm">Talent Matrix</span>
                <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.2</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-pink-500 rounded-full" style="width:18%"></div>
              </div>
              <span class="text-sm font-black text-indigo-600 w-8 text-right">2d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Ranked view Â· Top 5 â†’ Google Calendar Â· Rejection letters</p>
          </div>

          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ›¡ï¸</span>
                <span class="font-black text-slate-900 text-sm">Anonymous Quota</span>
                <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.3</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-amber-400 rounded-full" style="width:18%"></div>
              </div>
              <span class="text-sm font-black text-indigo-600 w-8 text-right">2d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">IP fingerprint Â· Soft 80% warn Â· Hard cap Â· Real-time counter</p>
          </div>

          <!-- Total bar -->
          <div class="bg-indigo-50 border border-indigo-100 rounded-2xl p-4 flex items-center justify-between">
            <div>
              <p class="text-xs font-black text-indigo-600 uppercase tracking-wide">Total MVP Build</p>
              <div class="flex items-center space-x-2 mt-2">
                <div class="w-32 h-2 bg-indigo-100 rounded-full overflow-hidden">
                  <div class="h-full bg-indigo-600 rounded-full" style="width:68%"></div>
                </div>
                <span class="text-xs text-indigo-400">11.5 of 17 days</span>
              </div>
            </div>
            <span class="text-3xl font-black text-indigo-600">11.5d</span>
          </div>
        </div>

        <!-- Month 2 Column -->
        <div class="space-y-3 opacity-40">
          <p class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center space-x-2 mb-4">
            <span class="w-1.5 h-4 bg-slate-300 rounded-full inline-block"></span><span>Month 2 â€” Deferred (13d total)</span>
          </p>

          <div class="bg-slate-50 border border-dashed border-slate-200 rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ”—</span>
                <span class="font-black text-slate-500 text-sm">ATS Integrations</span>
                <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.4</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-slate-400 rounded-full" style="width:38%"></div></div>
              <span class="text-sm font-black text-slate-400 w-8 text-right">5d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Greenhouse Â· Lever Â· Workday</p>
          </div>

          <div class="bg-slate-50 border border-dashed border-slate-200 rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ“§</span>
                <span class="font-black text-slate-500 text-sm">Email-in Apply</span>
                <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.4</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-slate-400 rounded-full" style="width:23%"></div></div>
              <span class="text-sm font-black text-slate-400 w-8 text-right">3d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Inbound parsing Â· Auto-attach to job</p>
          </div>

          <div class="bg-slate-50 border border-dashed border-slate-200 rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸªŸ</span>
                <span class="font-black text-slate-500 text-sm">Embed Widget</span>
                <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.4</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-slate-400 rounded-full" style="width:15%"></div></div>
              <span class="text-sm font-black text-slate-400 w-8 text-right">2d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">iFrame job board Â· Custom domain</p>
          </div>

          <div class="bg-slate-50 border border-dashed border-slate-200 rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="text-lg">ğŸ‘¥</span>
                <span class="font-black text-slate-500 text-sm">Multi-seat</span>
                <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-lg">Pro</span>
              </div>
              <span class="text-xs font-bold text-slate-400">Ph.4</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-slate-400 rounded-full" style="width:23%"></div></div>
              <span class="text-sm font-black text-slate-400 w-8 text-right">3d</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">Team invites Â· Role management</p>
          </div>

          <div class="bg-slate-100 border border-dashed border-slate-200 rounded-2xl p-4 flex items-center justify-between">
            <div>
              <p class="text-xs font-black text-slate-400 uppercase tracking-wide">Month 2 Total</p>
              <div class="flex items-center space-x-2 mt-2">
                <div class="w-32 h-2 bg-slate-200 rounded-full overflow-hidden">
                  <div class="h-full bg-slate-400 rounded-full" style="width:100%"></div>
                </div>
              </div>
            </div>
            <span class="text-3xl font-black text-slate-400">13d</span>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ INFOGRAPHIC 4: BUILD TIMELINE (Phase 1) â”€â”€ -->
    <section class="pb-20">
      <h2 class="text-2xl font-black text-slate-900 mb-1">Phase 1 â€” Foundation <span class="text-slate-400 font-normal text-lg">(Days 1â€“9)</span></h2>
      <p class="text-slate-500 text-sm mb-8">Core infrastructure shipped in the first sprint.</p>

      <!-- Day timeline ruler -->
      <div class="bg-white border border-slate-200 rounded-[2rem] p-8 shadow-sm mb-6">
        <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-5">Build Timeline â€” 9 Days</p>
        <div class="relative">
          <!-- ruler track -->
          <div class="h-2 bg-slate-100 rounded-full mb-6 relative overflow-hidden">
            <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-emerald-400 via-violet-500 to-pink-500 rounded-full" style="width:53%"></div>
          </div>
          <!-- day labels -->
          <div class="flex justify-between text-xs text-slate-400 font-bold -mt-2 mb-6">
            <span>Day 1</span><span>Day 2</span><span>Day 3</span><span>Day 4</span><span>Day 5</span><span>Day 6</span><span>Day 7</span><span>Day 8</span><span>Day 9</span>
          </div>
          <!-- feature bars -->
          <div class="space-y-3">
            <div class="flex items-center space-x-4">
              <span class="text-xs font-bold text-slate-500 w-36 text-right flex-shrink-0">Form + DB</span>
              <div class="flex-1 relative h-7 bg-slate-50 rounded-xl overflow-hidden border border-slate-100">
                <div class="absolute inset-y-0 left-0 bg-emerald-400/20 border-r-2 border-emerald-400 flex items-center pl-2" style="width:5.5%">
                </div>
                <span class="absolute inset-y-0 flex items-center text-xs font-bold text-emerald-600 pl-2">0.5d</span>
              </div>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-xs font-bold text-slate-500 w-36 text-right flex-shrink-0">Public Apply Page</span>
              <div class="flex-1 relative h-7 bg-slate-50 rounded-xl overflow-hidden border border-slate-100">
                <div class="absolute inset-y-0 bg-indigo-400/20 border-r-2 border-indigo-400" style="left:5.5%; width:16.5%"></div>
                <span class="absolute inset-y-0 flex items-center text-xs font-bold text-indigo-600" style="left:7%">1.5d</span>
              </div>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-xs font-bold text-slate-500 w-36 text-right flex-shrink-0">URL + Job Board</span>
              <div class="flex-1 relative h-7 bg-slate-50 rounded-xl overflow-hidden border border-slate-100">
                <div class="absolute inset-y-0 bg-violet-400/20 border-r-2 border-violet-400" style="left:22%; width:5.5%"></div>
                <span class="absolute inset-y-0 flex items-center text-xs font-bold text-violet-600" style="left:24%">0.5d</span>
              </div>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-xs font-bold text-slate-500 w-36 text-right flex-shrink-0">Auto-trigger AI</span>
              <div class="flex-1 relative h-7 bg-slate-50 rounded-xl overflow-hidden border border-slate-100">
                <div class="absolute inset-y-0 bg-pink-400/20 border-r-2 border-pink-400" style="left:27.5%; width:11%"></div>
                <span class="absolute inset-y-0 flex items-center text-xs font-bold text-pink-600" style="left:29%">1d</span>
              </div>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-xs font-bold text-slate-500 w-36 text-right flex-shrink-0">AI Screening</span>
              <div class="flex-1 relative h-7 bg-slate-50 rounded-xl overflow-hidden border border-slate-100">
                <div class="absolute inset-y-0 bg-violet-500/20 border-r-2 border-violet-500" style="left:38.5%; width:44%"></div>
                <span class="absolute inset-y-0 flex items-center text-xs font-bold text-violet-700" style="left:40%">4d</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feature Cards -->
      <div class="grid md:grid-cols-3 gap-5">
        <div class="md:col-span-3 grid grid-cols-5 gap-3">
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl">ğŸ“</span>
              <span class="text-2xl font-black text-indigo-600">0.5d</span>
            </div>
            <p class="font-black text-slate-900 text-sm">Form + DB</p>
            <p class="text-xs text-slate-400 mt-2 leading-snug">Firestore jobs collection with per-user RLS</p>
          </div>
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl">ğŸ“</span>
              <span class="text-2xl font-black text-indigo-600">1.5d</span>
            </div>
            <p class="font-black text-slate-900 text-sm">Public Apply Page</p>
            <p class="text-xs text-slate-400 mt-2 leading-snug">Email + PDF/DOC upload, quota check</p>
          </div>
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl">ğŸ”—</span>
              <span class="text-2xl font-black text-indigo-600">0.5d</span>
            </div>
            <p class="font-black text-slate-900 text-sm">URL + Job Board</p>
            <p class="text-xs text-slate-400 mt-2 leading-snug">hireai.app/jobs/[slug] shareable</p>
          </div>
          <div class="bg-emerald-50 border border-emerald-200 rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl">âœ…</span>
              <span class="text-2xl font-black text-emerald-500">0d</span>
            </div>
            <p class="font-black text-slate-900 text-sm">Standalone Mode</p>
            <p class="text-xs text-slate-400 mt-2 leading-snug">Already done âœ“</p>
          </div>
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <span class="text-xl">âš¡</span>
              <span class="text-2xl font-black text-indigo-600">1d</span>
            </div>
            <p class="font-black text-slate-900 text-sm">Auto-trigger AI</p>
            <p class="text-xs text-slate-400 mt-2 leading-snug">On new apply â†’ queue screening</p>
          </div>
        </div>

        <div class="bg-violet-50 border border-violet-200 rounded-[1.5rem] p-7">
          <div class="flex items-center space-x-3 mb-5">
            <div class="w-10 h-10 bg-violet-100 rounded-xl flex items-center justify-center text-xl">ğŸ§ </div>
            <div><p class="font-black text-slate-900">AI Screening</p><p class="text-xs text-violet-600 font-bold">Pro Â· 4 days</p></div>
          </div>
          <div class="space-y-3">
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-violet-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Claude API â€” ~$0.003 / CV at 50-CV batches</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-violet-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Google Drive (OAuth read-only scope)</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-violet-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">OneDrive via MS Graph â€” 25 MB limit</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-violet-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Hard cap: 200 CVs per run</span>
            </div>
          </div>
        </div>

        <div class="bg-pink-50 border border-pink-200 rounded-[1.5rem] p-7">
          <div class="flex items-center space-x-3 mb-5">
            <div class="w-10 h-10 bg-pink-100 rounded-xl flex items-center justify-center text-xl">ğŸ“Š</div>
            <div><p class="font-black text-slate-900">Talent Matrix</p><p class="text-xs text-pink-600 font-bold">Pro Â· Phase 2 Â· 2 days</p></div>
          </div>
          <div class="space-y-3">
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-pink-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Top 5 â†’ Google Calendar invite (with guest email)</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-pink-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Others â†’ formatted rejection letter flow</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-pink-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Employer edits rejection + invite templates</span>
            </div>
            <div class="flex items-center space-x-3">
              <div class="w-2 h-2 rounded-full bg-pink-400 flex-shrink-0"></div>
              <span class="text-xs text-slate-600">Status: Invited Â· Rejected Â· Pending</span>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 rounded-[1.5rem] p-7 text-white">
          <p class="text-xs font-black text-slate-500 uppercase tracking-widest mb-4">Phase 1 Cost Estimate</p>
          <div class="space-y-3">
            <div class="flex justify-between items-center border-b border-slate-800 pb-2">
              <span class="text-slate-400 text-xs">Claude API (50 CVs)</span>
              <span class="font-black text-white">$0.15</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-800 pb-2">
              <span class="text-slate-400 text-xs">Claude API (200 CVs)</span>
              <span class="font-black text-white">$0.60</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-800 pb-2">
              <span class="text-slate-400 text-xs">Firebase Firestore</span>
              <span class="font-black text-emerald-400">Free tier</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-400 text-xs">Google Calendar API</span>
              <span class="font-black text-emerald-400">Free</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ INFOGRAPHIC 5: QUOTA GUARD FLOW (Phase 3) â”€â”€ -->
    <section class="pb-20">
      <h2 class="text-2xl font-black text-slate-900 mb-1">Phase 3 â€” Quota Guard <span class="text-slate-400 font-normal text-lg">(Days 14â€“15)</span></h2>
      <p class="text-slate-500 text-sm mb-8">The trickiest engineering problem: enforcing apply limits without requiring candidate accounts.</p>

      <div class="bg-amber-50 border border-amber-200 rounded-[2rem] p-8">
        <div class="flex items-center space-x-3 mb-8">
          <div class="bg-amber-100 p-2.5 rounded-xl text-xl">ğŸ›¡ï¸</div>
          <div>
            <h3 class="font-black text-slate-900 text-lg">Anonymous Quota Enforcement</h3>
            <p class="text-xs text-amber-700 font-bold">Pro Â· Phase 3 Â· 2 days â€” Hardest engineering problem in the product</p>
          </div>
        </div>

        <!-- Flow diagram -->
        <div class="flex items-stretch space-x-3 mb-8 overflow-x-auto pb-2">

          <div class="flex-1 min-w-[130px] bg-white border border-amber-200 rounded-2xl p-4 text-center">
            <p class="text-2xl mb-2">ğŸ™‹</p>
            <p class="font-black text-slate-900 text-xs">Candidate Submits</p>
            <p class="text-xs text-slate-400 mt-1">No account required</p>
          </div>

          <div class="self-center text-amber-400 font-black text-xl flex-shrink-0">â†’</div>

          <div class="flex-1 min-w-[130px] bg-white border border-amber-200 rounded-2xl p-4 text-center">
            <p class="text-2xl mb-2">ğŸ”</p>
            <p class="font-black text-slate-900 text-xs">IP + Fingerprint</p>
            <p class="text-xs text-slate-400 mt-1">Composite key lookup</p>
          </div>

          <div class="self-center text-amber-400 font-black text-xl flex-shrink-0">â†’</div>

          <div class="flex-1 min-w-[130px] bg-white border border-amber-200 rounded-2xl p-4 text-center">
            <p class="text-2xl mb-2">ğŸ”¢</p>
            <p class="font-black text-slate-900 text-xs">Counter Check</p>
            <div class="mt-2 space-y-1">
              <div class="flex items-center justify-between text-xs">
                <span class="text-slate-400">Soft</span>
                <span class="font-bold text-amber-600">80%</span>
              </div>
              <div class="w-full h-1.5 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-amber-400 rounded-full" style="width:80%"></div>
              </div>
              <div class="flex items-center justify-between text-xs">
                <span class="text-slate-400">Hard</span>
                <span class="font-bold text-red-600">100%</span>
              </div>
              <div class="w-full h-1.5 bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-red-500 rounded-full" style="width:100%"></div>
              </div>
            </div>
          </div>

          <div class="self-center text-amber-400 font-black text-xl flex-shrink-0">â†’</div>

          <div class="flex-1 min-w-[140px] space-y-2">
            <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-3 text-center">
              <p class="text-lg">âœ…</p>
              <p class="font-black text-emerald-700 text-xs">Allow</p>
              <p class="text-xs text-slate-400">Under quota</p>
            </div>
            <div class="bg-red-50 border border-red-200 rounded-xl p-3 text-center">
              <p class="text-lg">ğŸš«</p>
              <p class="font-black text-red-600 text-xs">Block</p>
              <p class="text-xs text-slate-400">Quota reached</p>
            </div>
          </div>

          <div class="self-center text-amber-400 font-black text-xl flex-shrink-0">â†’</div>

          <div class="flex-1 min-w-[130px] bg-white border border-amber-200 rounded-2xl p-4 text-center">
            <p class="text-2xl mb-2">ğŸ“Š</p>
            <p class="font-black text-slate-900 text-xs">Dashboard Update</p>
            <p class="text-xs text-slate-400 mt-1">Real-time recruiter view</p>
          </div>
        </div>

        <!-- Detail grid -->
        <div class="grid grid-cols-3 gap-3">
          <div class="bg-white border border-amber-100 rounded-2xl p-4">
            <p class="text-xs font-black text-amber-700 uppercase tracking-wide mb-2">Storage</p>
            <p class="text-sm text-slate-700">Firestore counter keyed on <code class="bg-amber-50 px-1 rounded text-xs">IP + fingerprint</code> composite</p>
          </div>
          <div class="bg-white border border-amber-100 rounded-2xl p-4">
            <p class="text-xs font-black text-amber-700 uppercase tracking-wide mb-2">Default Quota</p>
            <p class="text-sm text-slate-700">200 applications per job post â€” employer can adjust per role</p>
          </div>
          <div class="bg-white border border-amber-100 rounded-2xl p-4">
            <p class="text-xs font-black text-amber-700 uppercase tracking-wide mb-2">Quota Reset</p>
            <p class="text-sm text-slate-700">Reset counter â†’ automatically queues a new AI screening batch</p>
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ MONTH 2 ROADMAP â”€â”€ -->
    <section class="pb-20">
      <div class="flex items-center space-x-4 mb-8">
        <div class="flex-1 h-px bg-slate-200"></div>
        <div class="flex items-center space-x-2 bg-slate-100 border border-slate-200 px-5 py-2 rounded-full">
          <span class="text-slate-400 text-sm">ğŸ”’</span>
          <span class="text-xs font-black text-slate-400 uppercase tracking-widest">Month 2 Roadmap â€” Out of MVP Scope</span>
        </div>
        <div class="flex-1 h-px bg-slate-200"></div>
      </div>
      <div class="grid grid-cols-4 gap-4 opacity-35">
        <div class="bg-white border border-dashed border-slate-200 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <span class="text-2xl">ğŸ”—</span>
            <span class="text-xs font-bold text-slate-300 bg-slate-100 px-2 py-0.5 rounded-full">Phase 4 Â· 5d</span>
          </div>
          <p class="font-black text-slate-500 text-sm mb-2">ATS Integrations</p>
          <p class="text-xs text-slate-400 leading-snug">Greenhouse Â· Lever Â· Workday sync</p>
          <div class="mt-4 h-1 bg-slate-100 rounded-full"><div class="h-full bg-slate-300 rounded-full w-0"></div></div>
        </div>
        <div class="bg-white border border-dashed border-slate-200 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <span class="text-2xl">ğŸ“§</span>
            <span class="text-xs font-bold text-slate-300 bg-slate-100 px-2 py-0.5 rounded-full">Phase 4 Â· 3d</span>
          </div>
          <p class="font-black text-slate-500 text-sm mb-2">Email-in Apply</p>
          <p class="text-xs text-slate-400 leading-snug">Inbound parsing Â· Auto-attach to job</p>
          <div class="mt-4 h-1 bg-slate-100 rounded-full"><div class="h-full bg-slate-300 rounded-full w-0"></div></div>
        </div>
        <div class="bg-white border border-dashed border-slate-200 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <span class="text-2xl">ğŸªŸ</span>
            <span class="text-xs font-bold text-slate-300 bg-slate-100 px-2 py-0.5 rounded-full">Phase 4 Â· 2d</span>
          </div>
          <p class="font-black text-slate-500 text-sm mb-2">Embed Widget</p>
          <p class="text-xs text-slate-400 leading-snug">iFrame job board Â· Custom domain</p>
          <div class="mt-4 h-1 bg-slate-100 rounded-full"><div class="h-full bg-slate-300 rounded-full w-0"></div></div>
        </div>
        <div class="bg-white border border-dashed border-slate-200 rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <span class="text-2xl">ğŸ‘¥</span>
            <span class="text-xs font-bold text-slate-300 bg-slate-100 px-2 py-0.5 rounded-full">Phase 4 Â· 3d</span>
          </div>
          <p class="font-black text-slate-500 text-sm mb-2">Multi-seat</p>
          <p class="text-xs text-slate-400 leading-snug">Team invites Â· Role management</p>
          <div class="mt-4 h-1 bg-slate-100 rounded-full"><div class="h-full bg-slate-300 rounded-full w-0"></div></div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ PRICING â”€â”€ -->
    <section class="pb-24">
      <h2 class="text-2xl font-black text-slate-900 mb-2 text-center">Simple Pricing</h2>
      <p class="text-slate-500 text-center text-sm mb-12">Job posting is free forever. AI is where the magic is.</p>
      <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <div class="bg-white border-2 border-slate-200 rounded-[2rem] p-8 flex flex-col">
          <p class="font-black text-slate-400 text-sm uppercase tracking-wide mb-2">Free</p>
          <p class="text-5xl font-black text-slate-900 mb-6">$0 <span class="text-slate-400 font-normal text-xl">/ forever</span></p>
          <div class="bg-emerald-50 border border-emerald-200 rounded-2xl p-4 mb-6">
            <p class="font-black text-emerald-700 text-sm">Unlimited job posts â€” always free</p>
            <p class="text-xs text-emerald-600 mt-1">No cap, no expiry, no credit card.</p>
          </div>
          <ul class="space-y-2.5 text-sm flex-1">
            <li class="flex items-center space-x-2"><span class="text-emerald-500 font-bold">âœ“</span><span class="text-slate-700">Unlimited job posts</span></li>
            <li class="flex items-center space-x-2"><span class="text-emerald-500 font-bold">âœ“</span><span class="text-slate-700">Public apply pages (email + resume)</span></li>
            <li class="flex items-center space-x-2"><span class="text-emerald-500 font-bold">âœ“</span><span class="text-slate-700">Shareable job URLs</span></li>
            <li class="flex items-center space-x-2"><span class="text-slate-300">ğŸ”’</span><span class="text-slate-300">AI resume screening</span></li>
            <li class="flex items-center space-x-2"><span class="text-slate-300">ğŸ”’</span><span class="text-slate-300">Talent Matrix + calendar invites</span></li>
            <li class="flex items-center space-x-2"><span class="text-slate-300">ğŸ”’</span><span class="text-slate-300">Rejection letter templates</span></li>
          </ul>
          <button onclick="openAuth('register')" class="w-full mt-8 border-2 border-slate-900 text-slate-900 py-3.5 rounded-2xl font-bold hover:bg-slate-50 transition-colors">Get Started Free</button>
        </div>
        <div class="bg-slate-900 rounded-[2rem] p-8 flex flex-col">
          <p class="font-black text-indigo-400 text-sm uppercase tracking-wide mb-2">Pro</p>
          <p class="text-5xl font-black text-white mb-6">$99 <span class="text-slate-500 font-normal text-xl">/ month</span></p>
          <ul class="space-y-2.5 text-sm flex-1 mb-8">
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>AI resume screening (unlimited)</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Google Drive &amp; OneDrive import</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Claude API-powered scoring</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Batch processing up to 200 CVs</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Talent Matrix with ranked views</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Google Calendar interview scheduling</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Rejection letter templates</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Anonymous quota enforcement</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Custom scoring criteria</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Export ranked list to CSV</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>Priority support</span></li>
            <li class="flex items-start space-x-2 text-slate-300"><span class="text-indigo-400 font-bold flex-shrink-0">âœ“</span><span>White-label apply page</span></li>
          </ul>
          <button onclick="openAuth('register')" class="w-full bg-indigo-600 text-white py-3.5 rounded-2xl font-bold hover:bg-indigo-500 transition-colors">Start Pro Trial</button>
        </div>
      </div>
    </section>

  </div>
</div><!-- end #page-landing -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-app" style="display:none" class="h-screen bg-slate-50">
  <div class="flex h-full">

    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-slate-200 p-6 flex flex-col flex-shrink-0">
      <div class="flex items-center space-x-2 px-2 mb-10">
        <div class="bg-indigo-600 p-1.5 rounded-lg text-white text-xs font-black">AI</div>
        <span class="text-xl font-black tracking-tight">HireAI</span>
      </div>
      <nav class="flex-1 space-y-1">
        <button onclick="showTab('jobs')" id="nav-jobs" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all bg-indigo-600 text-white shadow-lg">
          <span>ğŸ’¼</span><span>Job Posts</span>
        </button>
        <button onclick="showTab('screening')" id="nav-screening" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all text-slate-500 hover:bg-slate-50">
          <span>âš¡</span><span>AI Screening</span>
        </button>
        <button onclick="showTab('matrix')" id="nav-matrix" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all text-slate-500 hover:bg-slate-50">
          <span>ğŸ“Š</span><span>Talent Matrix</span>
        </button>
        <button onclick="showTab('templates')" id="nav-templates" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all text-slate-500 hover:bg-slate-50">
          <span>âœ‰ï¸</span><span>Email Templates</span>
        </button>
      </nav>
      <div class="border-t border-slate-100 pt-4 space-y-1">
        <p id="sidebar-email" class="text-xs text-slate-400 font-bold px-4 mb-2 truncate"></p>
        <button onclick="logout()" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:text-red-500 font-bold text-sm transition-colors">
          <span>â†©</span><span>Sign Out</span>
        </button>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 overflow-y-auto p-10">

      <!-- â”€â”€ JOB POSTS TAB â”€â”€ -->
      <div id="tab-jobs" style="display:block" class="max-w-5xl mx-auto space-y-8">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-black">Job Posts</h1>
            <p class="text-slate-500 text-sm mt-1">Free forever Â· Unlimited posts Â· Candidates apply with email + resume</p>
          </div>
          <button onclick="toggleJobForm()" class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center space-x-2 shadow-lg shadow-indigo-200 hover:bg-indigo-500 transition-colors">
            <span>+</span><span>New Job</span>
          </button>
        </div>

        <div id="job-form-wrap" style="display:none">
          <form onsubmit="createJob(event)" class="bg-white border border-slate-200 rounded-[2rem] p-8 shadow-sm space-y-4 fade-in">
            <h2 class="font-black text-xl">Create Job Post</h2>
            <div class="grid grid-cols-2 gap-4">
              <input id="f-title" required placeholder="Job title *" class="col-span-2 px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
              <input id="f-dept" placeholder="Department" class="px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
              <input id="f-location" placeholder="Location (e.g. Remote, NYC)" class="px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
              <select id="f-type" class="px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm">
                <option>Full-time</option><option>Part-time</option><option>Contract</option><option>Internship</option>
              </select>
              <input id="f-quota" type="number" min="1" value="200" placeholder="Application quota" class="px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm" />
            </div>
            <textarea id="f-desc" required rows="4" placeholder="Job description and requirements... *" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none"></textarea>
            <div class="flex space-x-3">
              <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold text-sm hover:bg-indigo-500 transition-colors">Publish Job</button>
              <button type="button" onclick="toggleJobForm()" class="border border-slate-200 px-6 py-3 rounded-2xl font-bold text-sm text-slate-600 hover:bg-slate-50">Cancel</button>
            </div>
          </form>
        </div>

        <div id="jobs-list"></div>
      </div>

      <!-- â”€â”€ AI SCREENING TAB â”€â”€ -->
      <div id="tab-screening" style="display:none" class="max-w-4xl mx-auto space-y-8">
        <div>
          <h1 class="text-3xl font-black">AI Screening</h1>
          <p class="text-slate-500 text-sm mt-1">Claude API Â· ~$0.003 / CV Â· max 200 CVs per batch</p>
        </div>
        <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">

          <!-- â”€â”€ FORM CONTENT (hidden while AI runs) â”€â”€ -->
          <div id="screening-form-content" class="space-y-6">
            <!-- Gemini API Key â€” saved state (shown when key exists) -->
            <div id="gemini-key-saved" style="display:none" class="flex items-center justify-between bg-emerald-50 border border-emerald-200 rounded-2xl px-5 py-3.5">
              <div class="flex items-center space-x-2.5">
                <span class="text-base">âœ…</span>
                <div>
                  <p class="text-sm font-black text-emerald-800">Gemini AI connected</p>
                  <p class="text-xs text-emerald-600">API key saved Â· real AI scoring active</p>
                </div>
              </div>
              <button onclick="changeGeminiKey()" class="text-xs font-bold text-slate-400 hover:text-slate-700 transition-colors underline">Change key</button>
            </div>

            <!-- Gemini API Key â€” setup state (shown when no key saved) -->
            <div id="gemini-key-setup" class="bg-amber-50 border border-amber-200 rounded-2xl p-5 space-y-3">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <p class="text-sm font-black text-amber-800">ğŸ”‘ Gemini API Key</p>
                  <p class="text-xs text-amber-700 mt-0.5">One-time setup. Free at <a href="https://aistudio.google.com" target="_blank" class="underline font-bold">aistudio.google.com</a> â†’ Get API key</p>
                </div>
                <button onclick="saveGeminiKey()" id="save-gemini-btn" class="flex-shrink-0 bg-amber-800 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-amber-700 transition-colors">Save</button>
              </div>
              <input id="gemini-key-input" type="password" placeholder="AIzaSyâ€¦" class="w-full px-4 py-3 bg-white border border-amber-200 rounded-2xl text-sm font-mono" />
              <p id="gemini-key-status" class="text-xs text-amber-600 font-bold" style="display:none"></p>
            </div>
            <div id="screening-job-selector"></div>
            <div id="pending-badge" style="display:none" class="bg-indigo-50 border border-indigo-100 rounded-2xl px-4 py-3 text-sm font-bold text-indigo-700"></div>
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Job Description &amp; Scoring Criteria</label>
              <textarea id="screening-jd" rows="5" placeholder="Describe the role, must-haves, nice-to-haves..." class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none"></textarea>
            </div>
            <div onclick="document.getElementById('cv-input').click()" class="border-2 border-dashed border-slate-200 rounded-3xl p-10 text-center cursor-pointer hover:bg-indigo-50/50 hover:border-indigo-200 transition-colors">
              <input type="file" id="cv-input" multiple class="hidden" onchange="onFilesSelected(event)" />
              <p class="text-3xl mb-3">ğŸ“„</p>
              <p class="font-bold text-slate-600">Drop additional resumes or click to browse</p>
              <p id="file-count-label" class="text-xs text-slate-400 mt-1">PDF, DOCX Â· max 200 CVs per batch</p>
            </div>
            <div class="flex items-center space-x-4 text-xs text-slate-400 font-bold border-t border-slate-100 pt-4 flex-wrap gap-y-1">
              <span>Gemini API</span><span class="text-slate-200">Â·</span><span>Google Drive</span><span class="text-slate-200">Â·</span><span>OneDrive</span><span class="text-slate-200">Â·</span><span>Firebase Functions</span>
            </div>
            <button onclick="runScreening()" id="screen-btn" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold flex items-center justify-center space-x-2 shadow-lg shadow-indigo-200 hover:bg-indigo-500 transition-colors">
              <span>âš¡</span><span id="screen-btn-label">Run AI Screening</span>
            </button>
          </div><!-- /screening-form-content -->

          <!-- â”€â”€ THINKING PANEL (shown while AI runs) â”€â”€ -->
          <div id="thinking-panel" style="display:none" class="py-4 fade-in">
            <!-- Header -->
            <div class="flex items-center space-x-4 mb-10">
              <div style="width:52px;height:52px;background:#4f46e5;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:22px;animation:spin 2s linear infinite;flex-shrink:0">âš¡</div>
              <div>
                <p class="text-xl font-black text-slate-900">Gemini AI is thinking</p>
                <p id="thinking-subtitle" class="text-sm text-slate-400 mt-0.5">Preparing your screening batchâ€¦</p>
              </div>
            </div>

            <!-- Step list -->
            <div id="thinking-steps" class="space-y-1 mb-10"></div>

            <!-- Progress bar -->
            <div class="space-y-2">
              <div class="flex justify-between text-xs font-bold text-slate-400">
                <span id="thinking-progress-label">Startingâ€¦</span>
                <span id="thinking-progress-pct">0%</span>
              </div>
              <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                <div id="thinking-progress-bar" class="h-full rounded-full" style="width:0%;background:linear-gradient(90deg,#6366f1,#8b5cf6);transition:width 0.7s cubic-bezier(0.4,0,0.2,1)"></div>
              </div>
            </div>
          </div><!-- /thinking-panel -->

        </div>
      </div>

      <!-- â”€â”€ TALENT MATRIX TAB â”€â”€ -->
      <div id="tab-matrix" style="display:none" class="max-w-5xl mx-auto space-y-8">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-black">Talent Matrix</h1>
            <p class="text-slate-500 text-sm mt-1">AI-ranked candidates Â· Top 5 â†’ Google Calendar Â· Rest â†’ Rejection letter</p>
          </div>
          <div id="matrix-legend" style="display:none" class="flex items-center space-x-4 text-xs font-bold">
            <span class="flex items-center space-x-1"><span class="w-2.5 h-2.5 rounded-full bg-indigo-500 inline-block"></span><span class="text-slate-500">Top 5</span></span>
            <span class="flex items-center space-x-1"><span class="w-2.5 h-2.5 rounded-full bg-slate-300 inline-block"></span><span class="text-slate-500">Others</span></span>
          </div>
        </div>
        <div id="matrix-list"></div>
      </div>

      <!-- â”€â”€ EMAIL TEMPLATES TAB â”€â”€ -->
      <div id="tab-templates" style="display:none" class="max-w-4xl mx-auto space-y-8">
        <div>
          <h1 class="text-3xl font-black">Email Templates</h1>
          <p class="text-slate-500 text-sm mt-1">Customise the rejection letter and interview invite sent to candidates.</p>
        </div>
        <div class="bg-indigo-50 border border-indigo-100 rounded-2xl px-5 py-4 text-sm text-indigo-700">
          <strong>Available variables:</strong> <code class="bg-white px-1 rounded">{{name}}</code> <code class="bg-white px-1 rounded">{{jobTitle}}</code> <code class="bg-white px-1 rounded">{{company}}</code> <code class="bg-white px-1 rounded">{{senderName}}</code>
        </div>

        <!-- Rejection Letter -->
        <div class="bg-white border border-slate-200 rounded-[2rem] p-8 shadow-sm space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="font-black text-xl">âœ‰ï¸ Rejection Letter</h2>
              <p class="text-xs text-slate-400 mt-1">Sent to candidates not in the top 5</p>
            </div>
            <button onclick="saveRejectionTemplate()" id="save-reject-btn" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-slate-800 transition-colors">Save</button>
          </div>
          <textarea id="rejection-template" rows="12" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none font-mono leading-relaxed"></textarea>
          <div class="border-t border-slate-100 pt-4">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-3">Preview</p>
            <div id="rejection-preview" class="bg-slate-50 border border-slate-100 rounded-2xl p-5 text-sm text-slate-600 whitespace-pre-wrap font-mono leading-relaxed"></div>
          </div>
        </div>

        <!-- Interview Invite -->
        <div class="bg-white border border-slate-200 rounded-[2rem] p-8 shadow-sm space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="font-black text-xl">ğŸ“… Interview Invite Message</h2>
              <p class="text-xs text-slate-400 mt-1">Shown in the Google Calendar event description when scheduling interviews</p>
            </div>
            <button onclick="saveInviteTemplate()" id="save-invite-btn" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-slate-800 transition-colors">Save</button>
          </div>
          <textarea id="invite-template" rows="10" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none font-mono leading-relaxed"></textarea>
          <div class="border-t border-slate-100 pt-4">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-3">Preview</p>
            <div id="invite-preview" class="bg-slate-50 border border-slate-100 rounded-2xl p-5 text-sm text-slate-600 whitespace-pre-wrap font-mono leading-relaxed"></div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div><!-- end #page-app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>

// â”€â”€â”€ FIREBASE CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â¬‡ Paste YOUR config from Firebase Console â†’ Project Settings â†’ Your apps
const firebaseConfig = {
  apiKey:            "AIzaSyBnp7qzd5F-GbbY0oTiEFV-BJBaCKTQ3Uc",
  authDomain:        "hireai-797e7.firebaseapp.com",
  projectId:         "hireai-797e7",
  storageBucket:     "hireai-797e7.firebasestorage.app",
  messagingSenderId: "45253228916",
  appId:             "1:45253228916:web:4d8932496c451d9eb9d421"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

// â”€â”€â”€ DEFAULT TEMPLATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_REJECTION = `Dear {{name}},

Thank you for taking the time to apply for the {{jobTitle}} position at {{company}}.

After careful consideration, we have decided to move forward with other candidates whose experience more closely aligns with our current needs.

We truly appreciate your interest and the effort you put into your application. We encourage you to apply for future opportunities that match your skills and background.

We wish you all the best in your search.

Warm regards,
{{senderName}}
{{company}}`;

const DEFAULT_INVITE = `Dear {{name}},

Congratulations! After reviewing your application for the {{jobTitle}} position, we are pleased to invite you to an interview.

We were impressed by your background and believe you could be a great fit for our team.

A calendar invite has been sent to {{email}}. If the proposed time doesn't work for you, please reply to suggest an alternative.

We look forward to speaking with you.

Best regards,
{{senderName}}
{{company}}`;

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let authMode          = 'login';
let currentUser       = null;
let selectedFiles     = [];
let currentApplyJobId = null;
let resumeFile        = null;
let rejectTarget      = null;
let screeningJobId    = null;

// â”€â”€â”€ FIRESTORE REFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const jobsCol    = () => db.collection(`users/${auth.currentUser.uid}/jobs`);
const appsCol    = () => db.collection(`users/${auth.currentUser.uid}/applications`);
const settingDoc = (name) => db.doc(`users/${auth.currentUser.uid}/settings/${name}`);

// â”€â”€â”€ DATA HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function getConfig() {
  try {
    const snap = await settingDoc('config').get();
    return snap.exists ? snap.data() : {};
  } catch { return {}; }
}
async function saveConfig(data) {
  await settingDoc('config').set(data, { merge: true });
}
async function getJobs() {
  try {
    const snap = await jobsCol().orderBy('createdAt', 'desc').get();
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  } catch { return []; }
}
async function getApplications() {
  try {
    const snap = await appsCol().get();
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  } catch { return []; }
}
async function getRankings() {
  try {
    const snap = await settingDoc('rankings').get();
    return snap.exists ? (snap.data().candidates || []) : [];
  } catch { return []; }
}
async function saveRankings(candidates) {
  await settingDoc('rankings').set({
    candidates,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  });
}
async function getTemplates() {
  try {
    const snap = await settingDoc('templates').get();
    return snap.exists ? snap.data() : { rejection: DEFAULT_REJECTION, invite: DEFAULT_INVITE };
  } catch { return { rejection: DEFAULT_REJECTION, invite: DEFAULT_INVITE }; }
}
async function saveTemplatesDB(data) {
  await settingDoc('templates').set(data);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  window.addEventListener('scroll', () => {
    const nav = document.getElementById('landing-nav');
    if (!nav) return;
    nav.className = window.scrollY > 20
      ? 'fixed w-full z-50 transition-all py-4 bg-white/80 backdrop-blur-md shadow-sm'
      : 'fixed w-full z-50 transition-all py-6';
  });

  auth.onAuthStateChanged(user => {
    // Hide loading screen as soon as Firebase auth state resolves
    const loader = document.getElementById('app-loader');
    if (loader) loader.style.display = 'none';

    if (user) {
      currentUser = { uid: user.uid, email: user.email, name: user.displayName || user.email.split('@')[0] };
      showApp();
    } else {
      currentUser = null;
      document.getElementById('page-app').style.display    = 'none';
      document.getElementById('page-landing').style.display = 'block';
    }
  });
});

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAuth(mode) {
  authMode = mode;
  updateAuthUI();
  const nameField = document.getElementById('auth-name');
  nameField.style.display = mode === 'register' ? 'block' : 'none';
  document.getElementById('auth-modal').style.display = 'flex';
}
function closeAuth() {
  document.getElementById('auth-modal').style.display = 'none';
  document.getElementById('auth-error').style.display = 'none';
  ['auth-name','auth-email','auth-password'].forEach(id => document.getElementById(id).value = '');
}
function toggleAuthMode() {
  authMode = authMode === 'login' ? 'register' : 'login';
  updateAuthUI();
  document.getElementById('auth-name').style.display = authMode === 'register' ? 'block' : 'none';
}
function updateAuthUI() {
  const isLogin = authMode === 'login';
  document.getElementById('auth-title').textContent       = isLogin ? 'Welcome back'            : 'Create your account';
  document.getElementById('auth-sub').textContent         = isLogin ? 'Sign in to HireAI'       : 'Start posting jobs for free';
  document.getElementById('auth-toggle-text').textContent = isLogin ? "Don't have an account?"  : 'Already have an account?';
  document.getElementById('auth-toggle-btn').textContent  = isLogin ? 'Sign up'                 : 'Sign in';
  document.getElementById('auth-error').style.display = 'none';
}
async function handleAuth(e) {
  e.preventDefault();
  const name     = document.getElementById('auth-name').value.trim();
  const email    = document.getElementById('auth-email').value.trim();
  const password = document.getElementById('auth-password').value;
  const errEl    = document.getElementById('auth-error');
  const btn      = e.target.querySelector('button[type="submit"]');
  btn.disabled    = true;
  btn.textContent = 'Please waitâ€¦';
  try {
    if (authMode === 'register') {
      const cred = await auth.createUserWithEmailAndPassword(email, password);
      await cred.user.updateProfile({ displayName: name || email.split('@')[0] });
    } else {
      await auth.signInWithEmailAndPassword(email, password);
    }
    closeAuth();
  } catch (err) {
    const msg = err.code === 'auth/email-already-in-use' ? 'An account with this email already exists.'
              : err.code === 'auth/wrong-password'        ? 'Incorrect password.'
              : err.code === 'auth/user-not-found'        ? 'No account found with this email.'
              : err.code === 'auth/weak-password'         ? 'Password must be at least 6 characters.'
              : err.message;
    showErr(errEl, msg);
    btn.disabled    = false;
    btn.textContent = 'Continue';
  }
}
function showErr(el, msg) { el.textContent = msg; el.style.display = 'block'; }
async function logout() {
  await auth.signOut();
  window.scrollTo(0, 0);
}

// â”€â”€â”€ APP SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showApp() {
  document.getElementById('page-landing').style.display = 'none';
  document.getElementById('page-app').style.display = 'block';
  document.getElementById('sidebar-email').textContent = currentUser.name || currentUser.email;
  showTab('jobs');
}
function showTab(id) {
  ['jobs','screening','matrix','templates'].forEach(t => {
    document.getElementById('tab-' + t).style.display = 'none';
    document.getElementById('nav-' + t).className =
      'w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all text-slate-500 hover:bg-slate-50';
  });
  document.getElementById('tab-' + id).style.display = 'block';
  document.getElementById('tab-' + id).classList.add('fade-in');
  document.getElementById('nav-' + id).className =
    'w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-bold text-sm transition-all bg-indigo-600 text-white shadow-lg';
  if (id === 'jobs')      renderJobs();
  if (id === 'screening') renderScreeningSelector();
  if (id === 'matrix')    renderMatrix();
  if (id === 'templates') renderTemplates();
}

// â”€â”€â”€ JOB POSTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleJobForm() {
  const el = document.getElementById('job-form-wrap');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
async function createJob(e) {
  e.preventDefault();
  const btn = e.target.querySelector('button[type="submit"]');
  btn.disabled    = true;
  btn.textContent = 'Savingâ€¦';
  const title    = document.getElementById('f-title').value.trim();
  const dept     = document.getElementById('f-dept').value.trim();
  const location = document.getElementById('f-location').value.trim();
  const type     = document.getElementById('f-type').value;
  const quota    = parseInt(document.getElementById('f-quota').value) || 200;
  const desc     = document.getElementById('f-desc').value.trim();
  await jobsCol().add({ title, dept, location, type, quota, desc, applications: 0, status: 'active', createdAt: firebase.firestore.FieldValue.serverTimestamp() });
  // Reset form immediately â€” don't block on the list re-fetch
  ['f-title','f-dept','f-location','f-desc'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('f-quota').value = '200';
  document.getElementById('job-form-wrap').style.display = 'none';
  btn.disabled    = false;
  btn.textContent = 'Publish Job';
  renderJobs(); // fire-and-forget â€” list updates in background
}
async function renderJobs() {
  const el = document.getElementById('jobs-list');
  const [jobs, apps] = await Promise.all([getJobs(), getApplications()]);
  if (!jobs.length) {
    el.innerHTML = `<div class="bg-white border-2 border-dashed border-slate-200 rounded-[2rem] p-20 text-center">
      <p class="text-5xl mb-4">ğŸ’¼</p>
      <p class="font-bold text-slate-400 mb-1">No jobs posted yet</p>
      <p class="text-sm text-slate-300">Create your first posting â€” free, always.</p></div>`;
    return;
  }
  el.innerHTML = jobs.map(job => {
    const jobApps = apps.filter(a => a.jobId === job.id);
    const total   = jobApps.length;
    const pending = jobApps.filter(a => a.status === 'pending').length;
    const pct     = Math.min(100, Math.round((total / job.quota) * 100));
    const bar     = pct >= 100 ? 'bg-red-500' : pct >= 80 ? 'bg-amber-400' : 'bg-emerald-500';
    const txt     = pct >= 80 ? 'text-amber-600' : 'text-slate-400';
    const meta    = [job.dept, job.location, job.type].filter(Boolean).join(' Â· ');
    return `<div class="bg-white border border-slate-200 rounded-[1.5rem] p-6 shadow-sm mb-4">
      <div class="flex items-start justify-between mb-4">
        <div>
          <h3 class="font-black text-slate-900 text-lg">${esc(job.title)}</h3>
          ${meta ? `<p class="text-sm text-slate-500 mt-0.5">${esc(meta)}</p>` : ''}
          ${pending > 0 ? `<span class="mt-2 inline-block bg-indigo-100 text-indigo-700 text-xs font-bold px-2.5 py-1 rounded-lg">${pending} pending review</span>` : ''}
        </div>
        <div class="flex items-center space-x-2 flex-shrink-0 ml-4">
          <button onclick="openApply('${job.id}')"
            class="flex items-center space-x-1.5 text-xs font-bold border border-emerald-200 text-emerald-700 bg-emerald-50 px-3 py-2 rounded-xl hover:bg-emerald-100 transition-colors">
            ğŸ‘ï¸ Apply Page
          </button>
          <button onclick="copyLink('${job.id}')" id="copy-${job.id}"
            class="flex items-center space-x-1.5 text-xs font-bold border border-slate-200 text-slate-500 px-3 py-2 rounded-xl hover:bg-slate-50 transition-colors">
            ğŸ”— Copy Link
          </button>
          <button onclick="screenJob('${job.id}')"
            class="flex items-center space-x-1.5 text-xs font-bold border border-indigo-200 text-indigo-600 px-3 py-2 rounded-xl hover:bg-indigo-50 transition-colors">
            âš¡ Screen CVs
          </button>
        </div>
      </div>
      <div>
        <div class="flex justify-between text-xs font-bold mb-1.5">
          <span class="${txt}">${total} / ${job.quota} applications</span>
          <span class="${txt}">${pct}%</span>
        </div>
        <div class="w-full h-1.5 bg-slate-100 rounded-full overflow-hidden">
          <div class="${bar} h-full rounded-full quota-fill" style="width:${pct}%"></div>
        </div>
      </div>
    </div>`;
  }).join('');
}
function copyLink(jobId) {
  const url = `${location.origin}${location.pathname}?apply=${jobId}`;
  navigator.clipboard.writeText(url).then(() => {
    const btn = document.getElementById('copy-' + jobId);
    if (!btn) return;
    const orig = btn.innerHTML;
    btn.innerHTML = 'âœ… Copied!';
    btn.classList.add('bg-emerald-50','border-emerald-200','text-emerald-600');
    setTimeout(() => { btn.innerHTML = orig; btn.classList.remove('bg-emerald-50','border-emerald-200','text-emerald-600'); }, 2000);
  });
}
function screenJob(jobId) {
  showTab('screening');
  setTimeout(async () => {
    screeningJobId = jobId;
    const jobs = await getJobs();
    const job  = jobs.find(j => j.id === jobId);
    if (job) document.getElementById('screening-jd').value = job.desc;
    const sel = document.getElementById('screening-job-sel');
    if (sel) sel.value = jobId;
    await updatePendingBadge(jobId);
  }, 100);
}

// â”€â”€â”€ APPLY MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function openApply(jobId) {
  currentApplyJobId = jobId;
  resumeFile = null;
  const jobs = await getJobs();
  const job  = jobs.find(j => j.id === jobId);
  document.getElementById('apply-job-label').textContent = job ? job.title : '';
  document.getElementById('apply-form-wrap').style.display = 'block';
  document.getElementById('apply-success').style.display = 'none';
  document.getElementById('apply-error').style.display = 'none';
  document.getElementById('resume-label').textContent = 'PDF or DOC / DOCX Â· max 10 MB';
  ['apply-name','apply-email'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('resume-input').value = '';
  document.getElementById('apply-modal').style.display = 'flex';
}
function closeApply() {
  document.getElementById('apply-modal').style.display = 'none';
  currentApplyJobId = null;
  resumeFile = null;
}
function onResumeSelected(e) {
  const file = e.target.files[0];
  if (!file) return;
  const ok = file.name.match(/\.(pdf|doc|docx)$/i);
  if (!ok) {
    document.getElementById('resume-label').textContent = 'âŒ Only PDF or DOC/DOCX accepted';
    document.getElementById('resume-input').value = '';
    resumeFile = null;
    return;
  }
  resumeFile = file;
  document.getElementById('resume-label').textContent = `âœ… ${file.name}`;
}
async function submitApplication(e) {
  e.preventDefault();
  const name  = document.getElementById('apply-name').value.trim();
  const email = document.getElementById('apply-email').value.trim();
  const errEl = document.getElementById('apply-error');
  if (!resumeFile) { showErr(errEl, 'Please upload your resume (PDF or DOC).'); return; }
  if (!name || !email) { showErr(errEl, 'Please fill in all required fields.'); return; }
  const btn = e.target.querySelector('button[type="submit"]');
  btn.disabled    = true;
  btn.textContent = 'Submittingâ€¦';
  try {
    const dup = await appsCol().where('jobId','==',currentApplyJobId).where('email','==',email.toLowerCase()).get();
    if (!dup.empty) { showErr(errEl, 'You have already applied for this position.'); btn.disabled = false; btn.textContent = 'Submit Application'; return; }
    const jobs = await getJobs();
    const job  = jobs.find(j => j.id === currentApplyJobId);
    const cvText = (document.getElementById('apply-cv-text')?.value || '').trim();
    await appsCol().add({ jobId: currentApplyJobId, jobTitle: job?.title || '', name, email: email.toLowerCase(), resumeName: resumeFile.name, cvText, status: 'pending', appliedAt: firebase.firestore.FieldValue.serverTimestamp() });
    if (job) await jobsCol().doc(currentApplyJobId).update({ applications: firebase.firestore.FieldValue.increment(1) });
    document.getElementById('apply-form-wrap').style.display = 'none';
    document.getElementById('apply-success').style.display   = 'block';
  } catch (err) { showErr(errEl, 'Something went wrong. Please try again.'); }
  btn.disabled    = false;
  btn.textContent = 'Submit Application';
}

// â”€â”€â”€ AI SCREENING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderScreeningSelector() {
  // Load saved Gemini key â€” show compact badge if already saved
  const config = await getConfig();
  if (config.geminiKey) {
    document.getElementById('gemini-key-saved').style.display = 'flex';
    document.getElementById('gemini-key-setup').style.display = 'none';
    document.getElementById('gemini-key-input').value = config.geminiKey;
  } else {
    document.getElementById('gemini-key-saved').style.display = 'none';
    document.getElementById('gemini-key-setup').style.display = 'block';
  }

  const jobs = await getJobs();
  const el   = document.getElementById('screening-job-selector');
  if (!jobs.length) { el.innerHTML = ''; return; }
  el.innerHTML = `<div>
    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Select Job to Screen</label>
    <select id="screening-job-sel" onchange="onScreeningJobChange(this.value)" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm">
      <option value="">â€” choose a job post â€”</option>
      ${jobs.map(j => `<option value="${j.id}">${esc(j.title)}${j.location ? ' Â· ' + esc(j.location) : ''}</option>`).join('')}
    </select></div>`;
  if (screeningJobId) {
    const sel = document.getElementById('screening-job-sel');
    if (sel) { sel.value = screeningJobId; await updatePendingBadge(screeningJobId); }
  }
}
async function onScreeningJobChange(jobId) {
  screeningJobId = jobId || null;
  const jobs = await getJobs();
  const job  = jobs.find(j => j.id === jobId);
  if (job) document.getElementById('screening-jd').value = job.desc;
  await updatePendingBadge(jobId);
}
async function updatePendingBadge(jobId) {
  const badge = document.getElementById('pending-badge');
  if (!jobId) { badge.style.display = 'none'; return; }
  const snap  = await appsCol().where('jobId','==',jobId).where('status','==','pending').get();
  const count = snap.size;
  if (count > 0) {
    badge.style.display = 'block';
    badge.textContent   = `ğŸ“¥ ${count} pending application${count > 1 ? 's' : ''} ready to screen for this job`;
  } else {
    badge.style.display = 'none';
  }
}
async function saveGeminiKey() {
  const key    = document.getElementById('gemini-key-input').value.trim();
  const status = document.getElementById('gemini-key-status');
  const btn    = document.getElementById('save-gemini-btn');
  if (!key) { status.textContent = 'âš ï¸ Enter a key first.'; status.style.display = 'block'; return; }
  btn.textContent = 'Savingâ€¦';
  await saveConfig({ geminiKey: key });
  btn.textContent = 'Save';
  status.style.display = 'none';
  // Collapse to the saved badge
  document.getElementById('gemini-key-saved').style.display = 'flex';
  document.getElementById('gemini-key-setup').style.display = 'none';
}

function changeGeminiKey() {
  document.getElementById('gemini-key-saved').style.display = 'none';
  document.getElementById('gemini-key-setup').style.display = 'block';
  const inp = document.getElementById('gemini-key-input');
  inp.value = '';
  document.getElementById('gemini-key-status').style.display = 'none';
  inp.focus();
}
function onFilesSelected(e) {
  selectedFiles = Array.from(e.target.files);
  document.getElementById('file-count-label').textContent = selectedFiles.length
    ? `${selectedFiles.length} file${selectedFiles.length > 1 ? 's' : ''} selected`
    : 'PDF, DOCX Â· max 200 CVs per batch';
}

// â”€â”€â”€ THINKING PANEL HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const THINKING_STEPS = [
  { id: 'read-jd',    label: 'Reading job description' },
  { id: 'load-cvs',   label: 'Loading candidate profiles' },
  { id: 'connect-ai', label: 'Connecting to Gemini API' },
  { id: 'scoring',    label: 'Gemini is reading & scoring rÃ©sumÃ©s' },
  { id: 'ranking',    label: 'Ranking candidates by score' },
  { id: 'saving',     label: 'Saving results to Talent Matrix' },
];

function showThinkingPanel() {
  document.getElementById('screening-form-content').style.display = 'none';
  const panel = document.getElementById('thinking-panel');
  panel.style.display = 'block';
  document.getElementById('thinking-subtitle').textContent = 'Preparing your screening batchâ€¦';
  setProgressBar(0, 'Startingâ€¦');
  const stepsEl = document.getElementById('thinking-steps');
  stepsEl.innerHTML = '';
  THINKING_STEPS.forEach(s => {
    const row = document.createElement('div');
    row.id = 'step-' + s.id;
    row.className = 'step-row flex items-center space-x-3 py-2';
    row.innerHTML = `
      <div id="dot-${s.id}" class="w-4 h-4 rounded-full bg-slate-200 flex-shrink-0 relative"></div>
      <span id="label-${s.id}" class="text-sm font-semibold text-slate-300">${s.label}</span>`;
    stepsEl.appendChild(row);
  });
}

function setStep(stepId, state, subtitle) {
  const dot   = document.getElementById('dot-' + stepId);
  const label = document.getElementById('label-' + stepId);
  if (!dot) return;
  if (state === 'active') {
    dot.className = 'w-4 h-4 rounded-full bg-indigo-500 flex-shrink-0 relative step-dot-active';
    dot.innerHTML = '';
    label.className = 'text-sm font-bold text-slate-900';
  } else if (state === 'done') {
    dot.className = 'w-4 h-4 rounded-full bg-emerald-500 flex-shrink-0 relative flex items-center justify-center';
    dot.innerHTML = '<svg width="8" height="6" viewBox="0 0 8 6" fill="none"><path d="M1 3l2 2 4-4" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    label.className = 'text-sm font-semibold text-slate-400';
  } else if (state === 'error') {
    dot.className = 'w-4 h-4 rounded-full bg-red-400 flex-shrink-0 relative';
    dot.innerHTML = '';
    label.className = 'text-sm font-semibold text-red-500';
  }
  if (subtitle) document.getElementById('thinking-subtitle').textContent = subtitle;
}

function setProgressBar(pct, label) {
  document.getElementById('thinking-progress-bar').style.width = pct + '%';
  document.getElementById('thinking-progress-pct').textContent  = Math.round(pct) + '%';
  if (label) document.getElementById('thinking-progress-label').textContent = label;
}

function hideThinkingPanel() {
  document.getElementById('thinking-panel').style.display = 'none';
  document.getElementById('screening-form-content').style.display = '';
}

async function runScreening() {
  const jd = document.getElementById('screening-jd').value.trim();
  if (!jd) { alert('Please add a job description first.'); return; }

  const config    = await getConfig();
  const geminiKey = config.geminiKey || '';
  const useAI     = !!geminiKey;
  const delay     = ms => new Promise(r => setTimeout(r, ms));

  document.getElementById('screen-btn').disabled = true;
  showThinkingPanel();

  // Step 1 â€” Read JD
  setStep('read-jd', 'active', 'Reading your job descriptionâ€¦');
  setProgressBar(5, 'Reading job descriptionâ€¦');
  await delay(600);
  setStep('read-jd', 'done');

  // Step 2 â€” Load candidates
  setStep('load-cvs', 'active', 'Loading candidate profiles from databaseâ€¦');
  setProgressBar(20, 'Loading candidatesâ€¦');
  const pendingSnap = screeningJobId
    ? await appsCol().where('jobId','==',screeningJobId).where('status','==','pending').get()
    : { docs: [] };
  const pendingApps = pendingSnap.docs.map(d => ({ id: d.id, ...d.data() }));
  const displayCount = pendingApps.length || 6;
  setStep('load-cvs', 'done', `Found ${displayCount} candidate${displayCount !== 1 ? 's' : ''} to screen`);
  setProgressBar(35, `${displayCount} candidates loaded`);
  await delay(350);

  let candidates;

  if (pendingApps.length > 0) {
    const rawCandidates = pendingApps.map((a, i) => ({
      id:       'r-' + Date.now().toString(36) + i,
      name:     a.name,
      email:    a.email,
      resume:   a.resumeName,
      cvText:   a.cvText || '',
      jobId:    screeningJobId,
      jobTitle: a.jobTitle,
      status:   'pending'
    }));

    if (useAI) {
      setStep('connect-ai', 'active', 'Establishing connection to Gemini APIâ€¦');
      setProgressBar(45, 'Connecting to Geminiâ€¦');
      await delay(500);
      setStep('connect-ai', 'done');

      setStep('scoring', 'active', `Gemini is reading & scoring ${rawCandidates.length} rÃ©sumÃ©${rawCandidates.length !== 1 ? 's' : ''}â€¦`);
      setProgressBar(55, 'AI scoring in progressâ€¦');
      try {
        const scores = await callGemini(geminiKey, jd, rawCandidates);
        candidates = rawCandidates.map((c, i) => ({
          ...c,
          score:     scores[i]?.score     ?? Math.floor(Math.random() * 45) + 50,
          reasoning: scores[i]?.reasoning ?? 'Scored by AI'
        })).sort((a, b) => b.score - a.score);
        setStep('scoring', 'done');
      } catch (err) {
        console.error('Gemini error:', err);
        setStep('scoring', 'error', 'Gemini unavailable â€” using estimated scores');
        await delay(800);
        candidates = rawCandidates.map(c => ({
          ...c, score: Math.floor(Math.random() * 45) + 50, reasoning: 'AI unavailable â€” estimated score'
        })).sort((a, b) => b.score - a.score);
      }
    } else {
      setStep('connect-ai', 'active', 'No API key â€” generating score estimatesâ€¦');
      setProgressBar(45, 'Processingâ€¦');
      await delay(900);
      setStep('connect-ai', 'done');
      setStep('scoring', 'active', 'Generating score estimatesâ€¦');
      setProgressBar(60, 'Estimating scoresâ€¦');
      await delay(1200);
      candidates = rawCandidates.map(c => ({
        ...c, score: Math.floor(Math.random() * 45) + 50, reasoning: 'Add Gemini API key for real AI scoring'
      })).sort((a, b) => b.score - a.score);
      setStep('scoring', 'done');
    }

    setStep('ranking', 'active', 'Ranking candidates by scoreâ€¦');
    setProgressBar(80, 'Ranking candidatesâ€¦');
    await delay(400);
    setStep('ranking', 'done');

    setStep('saving', 'active', 'Saving results to Talent Matrixâ€¦');
    setProgressBar(90, 'Saving to databaseâ€¦');
    const batch = db.batch();
    pendingApps.forEach(a => batch.update(appsCol().doc(a.id), { status: 'screened' }));
    await batch.commit();
    setStep('saving', 'done');

  } else {
    // Demo mode
    const jobs     = await getJobs();
    const jobTitle = jobs.find(j => j.id === screeningJobId)?.title || 'Role';
    const mockData = [
      { name:'Alex Rivera',   email:'alex@example.com',   cvText:'Senior software engineer with 7 years experience in React, Node.js, and AWS. Led teams of 5-10 engineers. Strong background in scalable architecture.' },
      { name:'Jordan Chen',   email:'jordan@example.com', cvText:'Full-stack developer with 5 years experience. Proficient in Vue, Python, and PostgreSQL. Contributed to open source projects.' },
      { name:'Sam Patel',     email:'sam@example.com',    cvText:'Backend developer 4 years, specialising in microservices and Kubernetes. Some frontend experience with React.' },
      { name:'Taylor Brooks', email:'taylor@example.com', cvText:'Mid-level developer 3 years experience. JavaScript and PHP. Has worked in agile teams at startups.' },
      { name:'Morgan Davis',  email:'morgan@example.com', cvText:'Junior developer 1 year experience, bootcamp graduate. Learning React and Node. Enthusiastic and fast learner.' },
      { name:'Casey Lee',     email:'casey@example.com',  cvText:'Recent graduate with internship experience in data entry and basic HTML/CSS. Eager to transition into software development.' },
    ];
    const rawCandidates = mockData.map((c, i) => ({
      id: 'r-' + i + '-' + Date.now().toString(36), ...c, resume: 'resume.pdf', jobId: screeningJobId, jobTitle, status: 'pending'
    }));

    if (useAI) {
      setStep('connect-ai', 'active', 'Establishing connection to Gemini APIâ€¦');
      setProgressBar(45, 'Connecting to Geminiâ€¦');
      await delay(500);
      setStep('connect-ai', 'done');

      setStep('scoring', 'active', 'Gemini is reading & scoring demo rÃ©sumÃ©sâ€¦');
      setProgressBar(55, 'AI scoring in progressâ€¦');
      try {
        const scores = await callGemini(geminiKey, jd, rawCandidates);
        candidates = rawCandidates.map((c, i) => ({
          ...c,
          score:     scores[i]?.score     ?? 50,
          reasoning: scores[i]?.reasoning ?? 'Scored by AI'
        })).sort((a, b) => b.score - a.score);
        setStep('scoring', 'done');
      } catch (err) {
        console.error('Gemini error:', err);
        setStep('scoring', 'error', 'Gemini unavailable â€” using demo scores');
        await delay(600);
        candidates = rawCandidates.map((c, i) => ({
          ...c, score: [92,87,79,71,58,44][i], reasoning: 'AI unavailable â€” using demo scores'
        }));
      }
    } else {
      setStep('connect-ai', 'active', 'No API key â€” using demo scoresâ€¦');
      setProgressBar(45, 'Processingâ€¦');
      await delay(900);
      setStep('connect-ai', 'done');
      setStep('scoring', 'active', 'Generating demo score estimatesâ€¦');
      setProgressBar(60, 'Using demo scoresâ€¦');
      await delay(1200);
      candidates = rawCandidates.map((c, i) => ({
        ...c, score: Math.max(10, Math.min(99, [92,87,79,71,58,44][i] + Math.floor(Math.random()*8)-4)),
        reasoning: 'Add Gemini API key above for real AI scoring'
      }));
      setStep('scoring', 'done');
    }

    setStep('ranking', 'active', 'Ranking candidates by scoreâ€¦');
    setProgressBar(80, 'Ranking candidatesâ€¦');
    await delay(400);
    setStep('ranking', 'done');

    setStep('saving', 'active', 'Saving results to Talent Matrixâ€¦');
    setProgressBar(90, 'Saving resultsâ€¦');
    await delay(350);
    setStep('saving', 'done');
  }

  await saveRankings(candidates);
  setProgressBar(100, 'Complete!');
  document.getElementById('thinking-subtitle').textContent = 'Screening complete â€” opening Talent Matrix âœ“';
  await delay(750);

  hideThinkingPanel();
  document.getElementById('screen-btn').disabled = false;
  document.getElementById('screen-btn-label').textContent = 'Run AI Screening';
  selectedFiles = [];
  document.getElementById('file-count-label').textContent = 'PDF, DOCX Â· max 200 CVs per batch';
  document.getElementById('cv-input').value = '';
  document.getElementById('pending-badge').style.display = 'none';
  showTab('matrix');
}

// â”€â”€â”€ GEMINI API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callGemini(apiKey, jd, candidates) {
  const prompt = `You are an expert technical recruiter. Score each candidate's resume against the job description below.

JOB DESCRIPTION:
${jd}

CANDIDATES:
${candidates.map((c, i) =>
  `${i + 1}. Name: ${c.name}
${c.cvText ? `Resume:\n${c.cvText.substring(0, 2000)}` : `Resume file: ${c.resume || 'not provided'}`}`
).join('\n---\n')}

Return a JSON array with exactly ${candidates.length} objects. One per candidate, in the same order:
[{"score": 85, "reasoning": "one concise sentence specific to this candidate"}]

Rules:
- score is 0-100 based on fit with the job description
- Be realistic and differentiate clearly between candidates
- reasoning must mention something specific about the candidate
- Return ONLY the JSON array, no markdown, no extra text`;

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
    {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: { temperature: 0.2, maxOutputTokens: 1024 }
      })
    }
  );
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err?.error?.message || `HTTP ${res.status}`);
  }
  const data = await res.json();
  const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '[]';
  return JSON.parse(text.replace(/```json|```/g, '').trim());
}

// â”€â”€â”€ TALENT MATRIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderMatrix() {
  const rankings = await getRankings();
  const el       = document.getElementById('matrix-list');
  const legend   = document.getElementById('matrix-legend');
  if (!rankings.length) {
    legend.style.display = 'none';
    el.innerHTML = `<div class="bg-white border-2 border-dashed border-slate-200 rounded-[2rem] p-20 text-center">
      <p class="text-5xl mb-4">ğŸ“Š</p>
      <p class="font-bold text-slate-400 mb-1">No results yet</p>
      <p class="text-sm text-slate-300">Run AI Screening to populate the matrix.</p></div>`;
    return;
  }
  legend.style.display = 'flex';
  el.innerHTML = rankings.map((r, i) => {
    const isTop5      = i < 5;
    const medal       = i === 0 ? 'bg-amber-400 text-white' : i === 1 ? 'bg-slate-400 text-white' : i === 2 ? 'bg-amber-700 text-white' : 'bg-slate-100 text-slate-500';
    const scoreColor  = r.score >= 80 ? 'text-emerald-600' : r.score >= 60 ? 'text-amber-600' : 'text-slate-400';
    const statusBadge = r.status === 'invited'  ? '<span class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded-lg ml-2">ğŸ“… Interview Scheduled</span>'
                      : r.status === 'rejected' ? '<span class="text-xs font-bold bg-red-50 text-red-500 px-2.5 py-1 rounded-lg ml-2">âœ‰ï¸ Rejection Sent</span>'
                      : '';
    const actions = isTop5
      ? `<button onclick="scheduleInterview('${r.id}')" class="text-xs font-bold border border-indigo-200 text-indigo-600 bg-indigo-50 px-3 py-2 rounded-xl hover:bg-indigo-100 transition-colors flex items-center space-x-1 ${r.status === 'invited' ? 'opacity-50' : ''}">ğŸ“… <span>Schedule Interview</span></button>`
      : `<button onclick="openRejectModal('${r.id}')" class="text-xs font-bold border border-red-100 text-red-500 bg-red-50 px-3 py-2 rounded-xl hover:bg-red-100 transition-colors flex items-center space-x-1 ${r.status === 'rejected' ? 'opacity-50' : ''}">âœ‰ï¸ <span>Send Rejection</span></button>`;
    return `<div class="bg-white border ${isTop5 ? 'border-indigo-100' : 'border-slate-200'} rounded-[1.5rem] p-6 flex items-center justify-between shadow-sm hover:shadow-md transition-shadow mb-3">
      <div class="flex items-center space-x-4 flex-1 min-w-0">
        <div class="w-9 h-9 rounded-full flex items-center justify-center font-black text-sm flex-shrink-0 ${medal}">${i + 1}</div>
        <div class="min-w-0">
          <div class="flex items-center flex-wrap gap-1">
            <p class="font-black text-slate-900">${esc(r.name)}</p>
            ${isTop5 ? '<span class="text-xs font-bold bg-indigo-600 text-white px-2 py-0.5 rounded-md">Top 5</span>' : ''}
            ${statusBadge}
          </div>
          <p class="text-xs text-slate-400 mt-0.5">${esc(r.email)}</p>
          <p class="text-sm text-slate-500 mt-1">${esc(r.reasoning)}</p>
        </div>
      </div>
      <div class="flex items-center space-x-4 flex-shrink-0 ml-6">
        <div class="text-right"><p class="text-4xl font-black ${scoreColor}">${r.score}</p><p class="text-xs text-slate-400 font-bold">/ 100</p></div>
        <div>${actions}</div>
      </div>
    </div>`;
  }).join('');
}

// Google Calendar scheduling
async function scheduleInterview(rankingId) {
  const rankings  = await getRankings();
  const r         = rankings.find(x => x.id === rankingId);
  if (!r) return;
  const templates = await getTemplates();
  const company   = currentUser.name || currentUser.email.split('@')[0];
  const body      = fillTemplate(templates.invite, { name: r.name, jobTitle: r.jobTitle || 'the role', company, senderName: company, email: r.email });
  const start = new Date(); start.setDate(start.getDate() + 7); start.setHours(10, 0, 0, 0);
  const end   = new Date(start); end.setHours(11, 0, 0, 0);
  const fmt   = d => d.toISOString().replace(/[-:.]/g, '').slice(0, 15) + 'Z';
  const params = new URLSearchParams({ action: 'EDIT', text: `Interview: ${r.name} â€” ${r.jobTitle || 'Role'}`, dates: `${fmt(start)}/${fmt(end)}`, details: body, add: r.email });
  window.open(`https://calendar.google.com/calendar/render?${params.toString()}`, '_blank');
  const updated = rankings.map(x => x.id === rankingId ? { ...x, status: 'invited' } : x);
  await saveRankings(updated);
  await renderMatrix();
}

// Rejection letter
async function openRejectModal(rankingId) {
  const rankings  = await getRankings();
  const r         = rankings.find(x => x.id === rankingId);
  if (!r) return;
  rejectTarget    = r;
  const templates = await getTemplates();
  const company   = currentUser.name || currentUser.email.split('@')[0];
  const body      = fillTemplate(templates.rejection, { name: r.name, jobTitle: r.jobTitle || 'the role', company, senderName: company });
  document.getElementById('reject-to-label').textContent = `To: ${r.name} <${r.email}>`;
  document.getElementById('reject-preview').textContent  = body;
  document.getElementById('reject-modal').style.display  = 'flex';
}
function closeRejectModal() {
  document.getElementById('reject-modal').style.display = 'none';
  rejectTarget = null;
}
async function openMailtoReject() {
  const templates = await getTemplates();
  const company   = currentUser.name || currentUser.email.split('@')[0];
  const body      = fillTemplate(templates.rejection, { name: rejectTarget.name, jobTitle: rejectTarget.jobTitle || 'the role', company, senderName: company });
  const subject   = `Your application for ${rejectTarget.jobTitle || 'the role'} at ${company}`;
  window.location.href = `mailto:${rejectTarget.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}
function copyRejectText() {
  const text = document.getElementById('reject-preview').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('copy-reject-btn');
    const orig = btn.textContent;
    btn.textContent = 'âœ… Copied!';
    setTimeout(() => btn.textContent = orig, 2000);
  });
}
async function confirmReject() {
  if (!rejectTarget) return;
  const rankings = await getRankings();
  const updated  = rankings.map(x => x.id === rejectTarget.id ? { ...x, status: 'rejected' } : x);
  await saveRankings(updated);
  closeRejectModal();
  await renderMatrix();
}

// â”€â”€â”€ EMAIL TEMPLATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderTemplates() {
  const t     = await getTemplates();
  const rejTA = document.getElementById('rejection-template');
  const invTA = document.getElementById('invite-template');
  rejTA.value = t.rejection;
  invTA.value = t.invite;
  updatePreviews();
  rejTA.oninput = updatePreviews;
  invTA.oninput = updatePreviews;
}
function updatePreviews() {
  const company = currentUser?.name || 'Your Company';
  const vars    = { name: 'Alex Rivera', jobTitle: 'Frontend Engineer', company, senderName: company, email: 'alex@example.com' };
  document.getElementById('rejection-preview').textContent = fillTemplate(document.getElementById('rejection-template').value, vars);
  document.getElementById('invite-preview').textContent    = fillTemplate(document.getElementById('invite-template').value, vars);
}
async function saveRejectionTemplate() {
  const t = await getTemplates();
  t.rejection = document.getElementById('rejection-template').value;
  await saveTemplatesDB(t);
  flashSaved('save-reject-btn');
}
async function saveInviteTemplate() {
  const t = await getTemplates();
  t.invite = document.getElementById('invite-template').value;
  await saveTemplatesDB(t);
  flashSaved('save-invite-btn');
}
function flashSaved(btnId) {
  const btn = document.getElementById(btnId);
  const orig = btn.textContent;
  btn.textContent = 'âœ… Saved';
  btn.classList.add('bg-emerald-600');
  setTimeout(() => { btn.textContent = orig; btn.classList.remove('bg-emerald-600'); }, 1800);
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s) {
  return String(s).replace(/[&<>"']/g, c =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function fillTemplate(tmpl, vars) {
  return tmpl.replace(/\{\{(\w+)\}\}/g, (_, k) => vars[k] || `{{${k}}}`);
}

</script>
</body>
</html>
